<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contract Event Log from Transaction</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>
</head>
<body>
    <h1>Smart Contract Event Details</h1>
    <div id="logs"></div>

    <script>
        // Setup Ethers provider
        const polygonRpcUrl = 'https://polygon-mainnet.g.alchemy.com/v2/ncx52BUu0ARYIishpcAGXjQQqnvzdy-c';
        const provider = new ethers.providers.JsonRpcProvider(polygonRpcUrl);

        // Smart Contract Details
        const contractAddress = '0xeb3b84249c02AdAfCD64320186B31c843e787Be1';
        const contractAbi = [
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "uint256[]",
                        "name": "tokenIds",
                        "type": "uint256[]"
                    },
                    {
                        "indexed": false,
                        "internalType": "string[]",
                        "name": "squareImageCID",
                        "type": "string[]"
                    },
                    {
                        "indexed": false,
                        "internalType": "string",
                        "name": "clickableURL",
                        "type": "string"
                    }
                ],
                "name": "SquaresImagesUpdated",
                "type": "event"
            }
        ];

        const contract = new ethers.Contract(contractAddress, contractAbi, provider);

        // Transaction hash of the event you want to retrieve
        const transactionHash = '0x89bf9e9b67f89ba896d5888789fa9a42eff799bb496718c85261c829be1961ff';

        async function getEventLogs() {
            const receipt = await provider.getTransactionReceipt(transactionHash);

            // Decode only the logs from our contract using its ABI
            const decodedEvents = receipt.logs.map(log => {
                try {
                    if (log.address === contractAddress) { // Filtering logs related to our contract
                        return contract.interface.parseLog(log);
                    }
                } catch (e) {
                    console.error("Error parsing log:", e);
                    return null;
                }
                return null;
            }).filter(event => event !== null);

            const logElement = document.getElementById('logs');
            let message = '';

            decodedEvents.forEach(event => {
                if (event.name === "SquaresImagesUpdated") {
                    const tokenIds = event.args.tokenIds.join(', ');
                    const imageCIDs = event.args.squareImageCID.join(', ');
                    const url = event.args.clickableURL;

                    message += `
                        <p>Token IDs: ${tokenIds}</p>
                        <p>Square Image CIDs: ${imageCIDs}</p>
                        <p>Clickable URL: ${url}</p>
                    `;
                }
            });

            logElement.innerHTML = message || '<p>No relevant events found in this transaction.</p>';
        }

        getEventLogs().catch(error => {
            console.error("Failed to load event logs:", error);
            document.getElementById('logs').innerHTML = `<p>Error loading logs: ${error.message}</p>`;
        });
    </script>
</body>
</html>
